function init(){gamestarted=!0,startGame(),x.start()}function startGame(){start=window.requestAnimationFrame(function(){if(15!=collectedCoins)dead?(myGameArea.context.font="50pt Calibri",myGameArea.context.fillText("GAME OVER! YOU ARE DEAD!",myGameArea.canvas.width/2-400,myGameArea.canvas.height/2)):(updateGame(),drawGame());else{x.stop(),myGameArea.context.font="50pt Calibri";var t=formatTime(x.time());checkHighscore(x.time()),myGameArea.context.fillText("YOU WON! TIME: "+t,myGameArea.canvas.width/2-400,myGameArea.canvas.height/2),dead=!0,cancelAnimationFrame(start)}start=window.requestAnimationFrame(function(){startGame()})})}function astroids(t){this.image=new Image,this.image.src=t.image,this.speed=t.speed,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.angle=t.angle;var e=0;this.ctx=t.context;var i=getRandomInt(-2,2);this.boundingbox=[],this.setSize=function(t,e){this.width=t,this.height=e},this.outOfBorders=function(){this.x-this.width>myGameArea.canvas.width&&(this.x=this.x-myGameArea.canvas.width-2*this.width),this.x<0-2*this.width&&(this.x=myGameArea.canvas.width+this.width),this.y-this.height>myGameArea.canvas.height&&(this.y=this.y-myGameArea.canvas.height-2*this.height),this.y<0-2*this.height&&(this.y=myGameArea.canvas.height+this.height)},this.generateBoundingBox=function(){this.boundingbox.r=this.width/2,this.boundingbox.x=this.x+2,this.boundingbox.y=this.y+2},this.update=function(){this.generateBoundingBox(),this.outOfBorders(),this.x+=this.speed*Math.cos(this.angle/180*Math.PI),this.y+=this.speed*Math.sin(this.angle/180*Math.PI)},this.draw=function(){e+=i*Math.PI/180,this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(e),this.ctx.drawImage(this.image,this.width/-2,this.height/-2,this.width,this.height),this.ctx.restore(),debug&&(myGameArea.context.lineWidth=2,this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(this.boundingbox.x,this.boundingbox.y,this.boundingbox.r,0,2*Math.PI),this.ctx.stroke())}}function player(t,e,i,a,n,o,h,s){this.width=t,this.height=e,this.x=a,this.y=n,this.ctx=o;var r=0,c=0,m=0;this.image=new Image,this.image.src=h,this.image2=new Image,this.image2.src=s,this.image3=new Image,this.image3.src="img/shipflame.png";this.boundingbox=[];var d=!1,g=!1,x=100,u=100;this.drawShieldStatus=function(){var t=x,e=0,i=t/100*Math.PI*2;myGameArea.canvas.width/2,myGameArea.canvas.height/2;myGameArea.context.fillStyle="#000",myGameArea.context.strokeStyle="rgba(0,94,128,0.5)",myGameArea.context.lineWidth=8,myGameArea.context.beginPath(),myGameArea.context.arc(this.x,this.y,40,e,i+e,!1),myGameArea.context.stroke()},this.drawLaserStatus=function(){var t=u,e=0,i=t/100*Math.PI*2;myGameArea.canvas.width/2,myGameArea.canvas.height/2;myGameArea.context.fillStyle="#000",myGameArea.context.strokeStyle="rgba(26,198,255,0.5)",myGameArea.context.lineWidth=8,myGameArea.context.beginPath(),myGameArea.context.arc(this.x,this.y,32,e,i+e,!1),myGameArea.context.stroke()},this.generateBoundingBox=function(){this.boundingbox.r=this.width/2,this.boundingbox.x=this.x,this.boundingbox.y=this.y},this.incrementAngle=function(){r+=5,r>=360&&(r=0)},this.decrementAngle=function(){r-=5,-360>r&&(r=0)},this.incrVelo=function(){c+=.5*Math.cos(Math.PI/180*r),m+=.5*Math.sin(Math.PI/180*r)},this.outOfBorders=function(){this.x>myGameArea.canvas.width&&(this.x=this.x-myGameArea.canvas.width),this.x<0&&(this.x=myGameArea.canvas.width),this.y>myGameArea.canvas.height&&(this.y=this.y-myGameArea.canvas.height),this.y<0&&(this.y=myGameArea.canvas.height)},this.shoot=function(){var t=this.midpoint();playerBullets.push(Bullet({speed:50,angle:r,x:t.x,y:t.y}))},this.midpoint=function(){return{x:this.x,y:this.y}},this.move=function(){g||(keys[38]?(this.incrVelo(),d=!0):keys[16]&&shieldpower>0?shieldactive=!0:(shieldactive=!1,d=!1),keys[39]&&this.incrementAngle(),keys[37]&&this.decrementAngle(),keys[32]&&laserpower>0&&(laserpower-=.5,this.shoot()))},this.update=function(){1==dead&&explosion.update(),this.generateBoundingBox(),this.move(),this.outOfBorders(),playerBullets.forEach(function(t){t.update()}),playerBullets=playerBullets.filter(function(t){return t.active})},this.draw=function(){this.x+=c,this.y+=m,playerBullets.forEach(function(t){t.draw()}),1==dead&&(explosion.draw(this.x-this.image.width/2,this.y-this.image.height/2),g=!0),g||(this.x+=c,this.y+=m,this.ctx.save(),this.ctx.translate(this.x,this.y),this.ctx.rotate(Math.PI/180*r),g||(shieldactive?(shieldpower-=.5,this.ctx.drawImage(this.image2,this.image2.width/-2,this.image2.height/-2,this.image2.width,this.image2.height)):d?this.ctx.drawImage(this.image3,this.image3.width/-2,this.image3.height/-2,this.image3.width,this.image3.height):this.ctx.drawImage(this.image,this.image.width/-2,this.image.height/-2,this.image.width,this.image.height)),x=linearScaling(0,50,0,100,shieldpower),u=linearScaling(0,20,0,100,laserpower),this.ctx.restore()),debug&&(myGameArea.context.lineWidth=2,this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(this.boundingbox.x,this.boundingbox.y,this.boundingbox.r,0,2*Math.PI),this.ctx.stroke())}}function checkCollision(t,e){this.update=function(){var i=Math.sqrt((t.boundingbox.x-e.boundingbox.x)*(t.boundingbox.x-e.boundingbox.x)+(t.boundingbox.y-e.boundingbox.y)*(t.boundingbox.y-e.boundingbox.y));i<t.boundingbox.r+e.boundingbox.r&&(collectedCoins++,coin1.updatePosition(getRandomInt(30,myGameArea.canvas.width-60),getRandomInt(30,myGameArea.canvas.height-60)))}}function checkAstroidsCollision(t,e){this.update=function(){e.forEach(function(e,i,a){var n=Math.sqrt((t.boundingbox.x-e.boundingbox.x)*(t.boundingbox.x-e.boundingbox.x)+(t.boundingbox.y-e.boundingbox.y)*(t.boundingbox.y-e.boundingbox.y));n<t.boundingbox.r+e.boundingbox.r&&(shieldactive||(dead=!0))})}}function checkShipShieldCollision(t,e){this.update=function(){var i=Math.sqrt((t.boundingbox.x-e.boundingbox.x)*(t.boundingbox.x-e.boundingbox.x)+(t.boundingbox.y-e.boundingbox.y)*(t.boundingbox.y-e.boundingbox.y));i<t.boundingbox.r+e.boundingbox.r&&(shieldcoin1.updatePosition(),e.collected=!0,shieldpower=50)}}function checkShipLaserCollision(t,e){this.update=function(){var i=Math.sqrt((t.boundingbox.x-e.boundingbox.x)*(t.boundingbox.x-e.boundingbox.x)+(t.boundingbox.y-e.boundingbox.y)*(t.boundingbox.y-e.boundingbox.y));i<t.boundingbox.r+e.boundingbox.r&&(lasercoin1.updatePosition(),laserpower=10)}}function checkLaserAstro(){this.update=function(t,e){t.forEach(function(t,i,a){e.forEach(function(e,a,n){var o=Math.sqrt((t.boundingbox.x-e.boundingbox.x)*(t.boundingbox.x-e.boundingbox.x)+(t.boundingbox.y-e.boundingbox.y)*(t.boundingbox.y-e.boundingbox.y));if(o<t.boundingbox.r+e.boundingbox.r){if(0==hit){if(hit=!0,e.width>40)for(var h=0;2>h;h++){var s=$.extend(!0,{},e);s.angle=getRandomInt(0,360),s.height=e.height/2,s.width=e.width/2,s.speed=getRandomInt(1,2),asto.push(s)}asto.splice(a,1),playerBullets.splice(i,1)}setTimeout(function(){hit=!1},400)}})})}}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function coin(t){this.image=new Image,this.image.src=t.image,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.ctx=myGameArea.context,this.boundingbox=[],this.updatePosition=function(t,e){this.x=t,this.y=e},this.generateBoundingBox=function(){this.boundingbox.r=this.width/2,this.boundingbox.x=this.x+20,this.boundingbox.y=this.y+20},this.draw=function(){this.generateBoundingBox(),this.ctx.drawImage(this.image,this.x,this.y,this.width,this.height),debug&&(this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.arc(this.boundingbox.x,this.boundingbox.y,this.boundingbox.r,0,2*Math.PI),this.ctx.stroke())}}function Bullet(t){return t.active=!0,t.xVelocity=0,t.yVelocity=10,t.r=.8,t.color="#000",this.angle=t.angle,t.boundingbox=[],t.generateBoundingBox=function(){t.boundingbox.r=t.r,t.boundingbox.x=this.x,t.boundingbox.y=this.y},t.inBounds=function(){return t.x>=0&&t.x<=myGameArea.canvas.width&&t.y>=0&&t.y<=myGameArea.canvas.height},t.update=function(){t.generateBoundingBox(),t.x+=10*Math.cos(t.angle/180*Math.PI),t.y+=10*Math.sin(t.angle/180*Math.PI),t.active=t.active&&t.inBounds()},t.draw=function(){myGameArea.context.beginPath(),myGameArea.context.strokeStyle="#4db8ff",myGameArea.context.lineWidth="1px",myGameArea.context.arc(t.x,t.y,t.r,0,2*Math.PI),myGameArea.context.stroke(),debug&&(myGameArea.context.strokeStyle="white",myGameArea.context.beginPath(),myGameArea.context.arc(t.boundingbox.x,t.boundingbox.y,t.boundingbox.r,0,2*Math.PI),myGameArea.context.stroke())},t}function generateShieldCoin(t){this.image=new Image,this.image.src=t,this.x=getRandomInt(50,myGameArea.canvas.width-50),this.y=getRandomInt(50,myGameArea.canvas.height-50),this.width=50,this.height=50,this.boundingbox=[],this.refresh=0,this.updatePosition=function(){this.x=getRandomInt(50,myGameArea.canvas.width-50),this.y=getRandomInt(50,myGameArea.canvas.height-50)},this.generateBoundingBox=function(){this.boundingbox.r=this.width/2,this.boundingbox.x=this.x,this.boundingbox.y=this.y},this.draw=function(){this.generateBoundingBox(),myGameArea.context.drawImage(this.image,this.x,this.y,this.width,this.height)}}function linearScaling(t,e,i,a,n){var o;return t!==e&&i!==a?(o=parseFloat((n-t)*(a-i)/(e-t)+i),o=o.toFixed(2)):o=error,o}function clsStopwatch(){var t=0,e=0,i=function(){return(new Date).getTime()};this.start=function(){t=t?t:i()},this.stop=function(){e=t?e+i()-t:e,t=0},this.reset=function(){e=t=0},this.time=function(){return e+(t?i()-t:0)}}function pad(t,e){var i="0000"+t;return i.substr(i.length-e)}function formatTime(t){var e=m=s=ms=0,i="";return e=Math.floor(t/36e5),t%=36e5,m=Math.floor(t/6e4),t%=6e4,s=Math.floor(t/1e3),ms=t%1e3,i=pad(e,2)+":"+pad(m,2)+":"+pad(s,2)+":"+pad(ms,3)}function openMenu(){var t=new Image;t.src=image,myGameArea.context.font="20pt Calibri",myGameArea.context.fillStyle="white",myGameArea.context.fillText("Controls: Arrow Up -> Speed up  Space -> Shoot  Shift -> Shield",myGameArea.canvas.width/2-370,myGameArea.canvas.height-150),myGameArea.context.fillText("Collect 15 Suns so fast as you can",myGameArea.canvas.width/2-140,myGameArea.canvas.height-200),myGameArea.context.fillText("Press Enter to Start the Game",myGameArea.canvas.width/2-120,myGameArea.canvas.height-100),myGameArea.context.drawImage(t,200,200,200,200)}function updateGame(){player1.update(),checkShipCoin.update(),checkShipShield.update(),checkShipLaser.update(),asto.forEach(function(t){t.update()}),checkShipAstro.update(),checkLaserAstro1.update(playerBullets,asto),explosion.update()}function checkHighscore(t){return this.newScore=t,this.highscore=Number(localStorage.getItem("astroracehighscore")),highscore?this.newScore<highscore?(setHighscore(t.toString()),!0):!1:(setHighscore(t.toString()),!0)}function getLastHighscore(){return Number(localStorage.getItem("astroracehighscore"))}function setHighscore(t){this.newScore=t.toString(),localStorage.setItem("astroracehighscore",this.newScore)}function drawGame(){myGameArea.clear(),coin1.draw(),player1.draw(),player1.drawShieldStatus(),player1.drawLaserStatus(),10>shieldpower&&shieldcoin1.draw(),0>=laserpower&&lasercoin1.draw(),asto.forEach(function(t){t.draw()}),myGameArea.context.font="20pt Calibri",myGameArea.context.fillStyle="#99d6ff",myGameArea.context.fillText("Actual Run",20,30),myGameArea.context.fillText(formatTime(x.time()),20,53),myGameArea.context.fillText("Collected Coins",200,30),myGameArea.context.fillText(collectedCoins+"/15",200,53),myGameArea.context.fillText("Best Time",400,30),myGameArea.context.fillText(formatTime(getLastHighscore()),400,53)}function SpriteSheet(t,e,i){this.image=new Image,this.frameWidth=e,this.frameHeight=i;var a=this;this.image.onload=function(){a.framesPerRow=Math.floor(a.image.width/a.frameWidth)},this.image.src=t}function Animation(t,e,i,a){for(var n=[],o=0,h=0,s=myGameArea.context,r=i;a>=r;r++)n.push(r);this.update=function(){h==e-1&&(o=(o+1)%n.length),h=(h+1)%e},this.draw=function(e,i){var a=Math.floor(n[o]/t.framesPerRow),h=Math.floor(n[o]%t.framesPerRow);s.drawImage(t.image,h*t.frameWidth,a*t.frameHeight,t.frameWidth,t.frameHeight,e,i,t.frameWidth,t.frameHeight)}}for(var myGameArea={canvas:document.getElementById("canvas"),context:this.canvas.getContext("2d"),clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},x=new clsStopwatch,clocktimer,asto=[],playerBullets=[],debug=!1,hit=!1,shieldactive=!1,collectedCoins=0,shieldpower=50,laserpower=10,gamestarted=!1,astrocount=15,keys=[],image="img/bg-min.jpg",logo="img/log.png",dead=!1,i=0;astrocount>i;i++){var size=getRandomInt(50,200),astro=new astroids({x:getRandomInt(150,myGameArea.canvas.width),y:getRandomInt(150,myGameArea.canvas.height),image:"img/astro.png",speed:getRandomInt(1,3),angle:getRandomInt(0,360),rot:getRandomInt(1,3),width:size,height:size,context:myGameArea.context});asto.push(astro)}var player1=new player(40,40,"red",100,100,myGameArea.context,"img/ship.png","img/shipshiel.png"),coin1=new coin({image:"img/coins.png",x:getRandomInt(150,myGameArea.canvas.width-60),y:getRandomInt(150,myGameArea.canvas.height-60),width:80,height:80}),shieldcoin1=new generateShieldCoin("img/shield.png"),lasercoin1=new generateShieldCoin("img/laser.png"),checkShipCoin=new checkCollision(player1,coin1),checkShipAstro=new checkAstroidsCollision(player1,asto),checkLaserAstro1=new checkLaserAstro,checkShipShield=new checkShipShieldCollision(player1,shieldcoin1),checkShipLaser=new checkShipLaserCollision(player1,lasercoin1),x=new clsStopwatch,start;myGameArea.canvas.style.backgroundRepeat="no-repeat",myGameArea.canvas.style.backgroundImage="url("+image+")",openMenu("img/log.jpg"),document.body.addEventListener("keydown",function(t){keys[t.keyCode]=!0,13!=t.keyCode||gamestarted||init(),82==t.keyCode&&dead&&location.reload()}),document.body.addEventListener("keyup",function(t){keys[t.keyCode]=!1}),spritesheet=new SpriteSheet("img/explosion.png",95.5,95.5),explosion=new Animation(spritesheet,2,6,10);